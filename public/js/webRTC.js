!function(e){var t={};function n(o){if(t[o])return t[o].exports;var l=t[o]={i:o,l:!1,exports:{}};return e[o].call(l.exports,l,l.exports,n),l.l=!0,l.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)n.d(o,l,function(t){return e[t]}.bind(null,l));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=7)}({7:function(e,t,n){e.exports=n("ww2S")},ww2S:function(e,t){var n,o,l,c=io("https://rtcserver.esuccess-inc.com:40002",{}),a=new Peer({initiator:!1,trickle:!1}),i=!1,r={},d=document.getElementById("myMediaContainer"),s=document.getElementById("videoGrid"),u=document.querySelector("select#audioSource"),m=document.querySelector("select#audioOutput"),v=document.querySelector("select#videoSource"),f=[u,m,v];function g(e){var t=f.map((function(e){return e.value}));f.forEach((function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}));for(var n=0;n!==e.length;++n){var o=e[n],l=document.createElement("option");l.value=o.deviceId,"audioinput"===o.kind?(l.text=o.label||"microphone ".concat(u.length+1),u.appendChild(l)):"audiooutput"===o.kind?(l.text=o.label||"speaker ".concat(m.length+1),m.appendChild(l)):"videoinput"===o.kind?(l.text=o.label||"camera ".concat(v.length+1),v.appendChild(l)):console.log("Some other kind of source/device: ",o)}f.forEach((function(e,n){Array.prototype.slice.call(e.childNodes).some((function(e){return e.value===t[n]}))&&(e.value=t[n])}))}function E(e,t){e.muted=!0,void 0!==e.sinkId?e.setSinkId(t).then((function(){console.log("Success, audio output device attached: ".concat(t))})).catch((function(e){var t=e;"SecurityError"===e.name&&(t="You need to use HTTPS for selecting audio output device: ".concat(e)),console.error(t),m.selectedIndex=0})):console.warn("Browser does not support output device selection.")}function b(e){data={id:myId,user:user,roomID:roomID},S(!1,!0,data)}function p(e,t){e.srcObject=t,e.addEventListener("loadedmetadata",(function(){e.play()})),s.append(e)}function h(e,t){e.srcObject=t,e.addEventListener("loadedmetadata",(function(){e.play()})),s.append(e)}function k(e,t,n){t.srcObject=n,t.addEventListener("loadedmetadata",(function(){t.play()}));var o=document.getElementById(e);o&&o.append(t)}function y(e){var t=document.getElementById(e);t&&(t.style.display="none")}function A(e){var t=document.getElementById(e);t&&t.remove()}function I(e,t,c){navigator.mediaDevices.getUserMedia(c).then((function(c){return A("myVideo"),A("myAudio"),1==t&&1==e?(null,n=c,window.stream=c,(o=document.createElement("video")).setAttribute("id","myVideo"),o.muted=!1,function(e,t){e.srcObject=t,e.muted=!0,e.addEventListener("loadedmetadata",(function(){e.play()})),d.append(e)}(o,c)):(n=null,window.stream=c,c,console.log("this is a audio only"),(l=document.createElement("audio")).setAttribute("id","myAudio"),l.setAttribute("controls","controls"),l.muted=!0,function(e,t){e.srcObject=t,e.muted=!0,e.addEventListener("loadedmetadata",(function(){e.play()})),d.append(e)}(l,c)),navigator.mediaDevices.enumerateDevices()})).then(g).catch((function(n){1==e&&1==t&&b()}))}function S(e,t,n){window.stream&&window.stream.getTracks().forEach((function(e){e.stop()}));var o=u.value,l=v.value;if(1==e&&1==t){var c={audio:{deviceId:o?{exact:o}:void 0},video:{deviceId:l?{exact:l}:void 0}};console.log("connect video : start"),I(e,t,c)}else if(0==e&&1==t){var a={audio:{deviceId:o?{exact:o}:void 0},video:!1};console.log("connect audio : start"),I(e,t,a)}}function D(){window.stream&&window.stream.getTracks().forEach((function(e){e.stop()}));var e=u.value,t=v.value,l={audio:{deviceId:e?{exact:e}:void 0},video:{deviceId:t?{exact:t}:void 0}};navigator.mediaDevices.getUserMedia(l).then((function(e){console.log("restarted"),window.stream=e,o.srcObject=e,n=e,data={id:myId,user:user,roomID:roomID,videoStream:n},c.emit("changeMedia",data),A(myId)})).catch(b)}function w(){var e=document.getElementById("lessonSlide");e&&(e.style.display="block");var t=document.getElementById("sharedVideo");t&&t.remove()}function T(){navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then((function(e){i=e;var t=document.createElement("video");t.setAttribute("id","sharedVideo"),t.muted=!1,k("lessonSharedContainer",t,e),y("lessonSlide"),console.log(r),Object.keys(r).forEach((function(e){var t=a.connect(e);t.on("open",(function(){var n={id:e,sharedScreen:!0};t.send(n);a.call(e,i)}))})),i.getVideoTracks()[0].onended=function(){var e,t;e="lessonSlide",(t=document.getElementById(e))&&(t.style.display="block"),document.getElementById("sharedVideo").remove(),Object.keys(r).forEach((function(e){var t=a.connect(e);t.on("open",(function(){var n={id:e,sharedScreen:!1};t.send(n)}))}))}}))}m.disabled=!("sinkId"in HTMLMediaElement.prototype),navigator.mediaDevices.enumerateDevices().then(g).catch(b),u.onchange=D,m.onchange=function(){var e=m.value;E(n?o:l,e)},v.onchange=D,a.on("connection",(function(e){e.on("data",(function(e){if(console.log("peer connected",e),1==e.sharedScreen)i=!0;else{if(0==e.sharedScreen)return w(),i=!1,!1;alert("the stream data")}})),e.on("close",(function(e){console.log("connection of peer has been closed",e)}))})),a.on("open",(function(e){console.log("my peer id"+e),console.log("my user ",user),console.log("my room id ",roomID),myId=e,data={id:e,user:user,roomID:roomID},c.emit("newUser",data);S(!0,!0,data)})),a.on("call",(function(e){var t=0;console.log("PEER:: CALLING... for a video stream or audio stream ...");var n=u.value,o=v.value,l={audio:{deviceId:n?{exact:n}:void 0},video:{deviceId:o?{exact:o}:void 0}};navigator.mediaDevices.getUserMedia(l).then((function(n){1==n.getAudioTracks().length&&n.getVideoTracks().length,e.answer(n),e.on("stream",(function(n){if(r[e.peer]=e,console.log("recieve video from initiator ",e),0==t){if(1==i)return sharedVid=document.createElement("video"),sharedVid.setAttribute("id","sharedVideo"),k("lessonSharedContainer",sharedVid,n),y("lessonSlide"),!1;1==n.getAudioTracks().length&&1==n.getVideoTracks().length?(A(e.peer),callerElement=document.createElement("video"),callerElement.setAttribute("id",e.peer),callerElement.setAttribute("class","peerCallBackVideo"),callerElement.muted=!1,h(callerElement,n)):(A(e.peer),callerElement=document.createElement("audio"),callerElement.setAttribute("id",e.peer),callerElement.setAttribute("class","peerCallBackAudio"),callerElement.setAttribute("controls","controls"),callerElement.muted=!1,p(callerElement,n))}t++})),e.on("close",(function(){A(e.peer),console.log("user disconected")}))})).catch((function(n){console.log("recieve audio from initiator",e);var o=u.value,l={audio:{deviceId:o?{exact:o}:void 0},video:!1};navigator.mediaDevices.getUserMedia(l).then((function(n){1==n.getAudioTracks().length&&n.getVideoTracks().length,e.answer(n),e.on("stream",(function(n){if(r[e.peer]=e,0==t){if(1==i)return sharedVid=document.createElement("video"),sharedVid.setAttribute("id","sharedVideo"),k("lessonSharedContainer",sharedVid,n),y("lessonSlide"),!1;1==n.getAudioTracks().length&&1==n.getVideoTracks().length?(A(e.peer),callerElement=document.createElement("video"),callerElement.setAttribute("id",e.peer),callerElement.setAttribute("class","peerCallBackVideo"),callerElement.muted=!1,h(callerElement,n)):(A(e.peer),callerElement=document.createElement("audio"),callerElement.setAttribute("id",e.peer),callerElement.setAttribute("class","peerCallBackAudio"),callerElement.setAttribute("controls","controls"),callerElement.muted=!1,p(callerElement,n))}t++})),e.on("close",(function(){A(e.peer),console.log("user disconected")}))})).catch((function(e){}))}))})),a.on("close",(function(e){document.getElementById(e).remove()})),c.on("userJoined",(function(e){r[e.id]=e,console.log("user joined ::: calling initiator with just audio and video",e.id);var t=u.value,o=v.value,l={audio:{deviceId:t?{exact:t}:void 0},video:{deviceId:o?{exact:o}:void 0}};navigator.mediaDevices.getUserMedia(l).then((function(t){if(console.log("user joined ::: calling initiator with just audio and video",e.id),callback=a.call(e.id,t),callback){r[callback.peer]=callback;var n=0;callback.on("stream",(function(t){0==n&&(1==t.getAudioTracks().length&&1==t.getVideoTracks().length?(A(e.id),callerElement=document.createElement("video"),callerElement.setAttribute("id",e.id),callerElement.setAttribute("class","user_joined_peer_call_back"),callerElement.muted=!1,h(callerElement,t)):(A(e.id),callerElement=document.createElement("audio"),callerElement.setAttribute("id",e.id),callerElement.setAttribute("class","user_joined_peer_call_back"),callerElement.setAttribute("controls","controls"),callerElement.muted=!1,p(callerElement,t))),n++})),callback.on("close",(function(){A(e.id)})),callback.on("error",(function(e){console.log(e)}))}})).catch((function(o){console.log("user joined:: I have only audio, send to the audio to my peer",e.id);var l={audio:{deviceId:t?{exact:t}:void 0},video:!1};navigator.mediaDevices.getUserMedia(l).then((function(t){if(n?callback=a.call(e.id,t):(e={id:myId,user:user,roomID:roomID,videoStream:t},c.emit("changeMedia",e),callback=null),callback){r[callback.peer]=callback;var o=0;callback.on("stream",(function(t){0==o&&(1==t.getAudioTracks().length&&1==t.getVideoTracks().length?(callerElement=document.createElement("video"),callerElement.setAttribute("id",e.id),callerElement.setAttribute("class","user_joined_peer_call_back"),callerElement.muted=!1,h(callerElement,t)):(A(e.id),callerElement=document.createElement("audio"),callerElement.setAttribute("id",e.id),callerElement.setAttribute("class","user_joined_peer_call_back"),callerElement.setAttribute("controls","controls"),callerElement.muted=!1,p(callerElement,t))),o++})),callback.on("close",(function(){A(e.id)})),callback.on("error",(function(e){console.log(e)})),r[e.id]=callback}})).catch((function(e){console.log(e)}))}))})),c.on("mediaChanged",(function(e){var t=u.value,n=v.value,o={audio:{deviceId:t?{exact:t}:void 0},video:{deviceId:n?{exact:n}:void 0}};navigator.mediaDevices.getUserMedia(o).then((function(t){if(console.log("mediaChanged: initiator (recieved)"),callback=a.call(e.id,t),callback){var n=0;callback.on("stream",(function(t){0==n&&(console.log("repipient callback : video stream"),1==t.getAudioTracks().length&&1==t.getVideoTracks().length?(A(e.id),callerElement=document.createElement("video"),callerElement.setAttribute("id",callback.peer),callerElement.setAttribute("class","repipient_video_changed"),callerElement.muted=!1,h(callerElement,t)):(A(e.id),callerElement=document.createElement("audio"),callerElement.setAttribute("id",e.id),callerElement.setAttribute("class","repipient_audio_changed"),callerElement.setAttribute("controls","controls"),callerElement.muted=!1,p(callerElement,t))),n++})),callback.on("close",(function(){A(e.id)})),callback.on("error",(function(e){console.log(e)})),r[e.id]=callback}})).catch((function(n){var o={audio:{deviceId:t?{exact:t}:void 0},video:!1};navigator.mediaDevices.getUserMedia(o).then((function(t){if(console.log("initiator SENT AND AUDIO"),callback=a.call(e.id,t),callback){var n=0;callback.on("stream",(function(e){console.log("this is for the audio, stream of the initiator"),0==n&&(console.log(e.getAudioTracks().length),console.log(e.getVideoTracks().length),1==e.getAudioTracks().length&&1==e.getVideoTracks().length?(console.log("user sent a video"),A(callback.peer),callerElement=document.createElement("video"),callerElement.setAttribute("id",callback.peer),callerElement.setAttribute("class","callerBackVideo"),callerElement.muted=!1,h(callerElement,e)):(console.log("user sent a AUDIO"),A(callback.peer),callerElement=document.createElement("audio"),callerElement.setAttribute("id",callback.peer),callerElement.setAttribute("class","callbackAudio_media"),callerElement.setAttribute("controls","controls"),callerElement.muted=!1,p(callerElement,e))),n++})),callback.on("close",(function(){A(e.id)})),callback.on("error",(function(e){console.log(e)})),r[e.id]=callback}})).catch((function(e){console.log(e)}))}))})),c.on("userDisconnect",(function(e){console.log("userDisconnected",e),A(e);try{r[e].close()}catch(e){console.log("error disconnect : ",e)}})),document.getElementById("btnShareScreen").addEventListener("click",(function(){T()}))}});
//# sourceMappingURL=webRTC.js.map