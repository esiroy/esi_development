!function(e){var n={};function o(t){if(n[t])return n[t].exports;var c=n[t]={i:t,l:!1,exports:{}};return e[t].call(c.exports,c,c.exports,o),c.l=!0,c.exports}o.m=e,o.c=n,o.d=function(e,n,t){o.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,n){if(1&n&&(e=o(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var c in e)o.d(t,c,function(n){return e[n]}.bind(null,c));return t},o.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(n,"a",n),n},o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},o.p="/",o(o.s=7)}({7:function(e,n,o){e.exports=o("ww2S")},ww2S:function(e,n){var o,t,c=io("https://rtcserver.esuccess-inc.com:40002",{}),i=new Peer,r=document.getElementById("videoGrid"),a=document.createElement("video");a.setAttribute("id","myVideo"),a.muted=!0,console.log("user",user);var d=document.createElement("video");d.setAttribute("id","sharedVideo"),d.muted=!0;var u=document.querySelector("select#audioSource"),l=document.querySelector("select#audioOutput"),s=document.querySelector("select#videoSource"),f=[u,l,s];function m(e){var n=f.map((function(e){return e.value}));f.forEach((function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}));for(var o=0;o!==e.length;++o){var t=e[o],c=document.createElement("option");c.value=t.deviceId,"audioinput"===t.kind?(c.text=t.label||"microphone ".concat(u.length+1),u.appendChild(c)):"audiooutput"===t.kind?(c.text=t.label||"speaker ".concat(l.length+1),l.appendChild(c)):"videoinput"===t.kind?(c.text=t.label||"camera ".concat(s.length+1),s.appendChild(c)):console.log("Some other kind of source/device: ",t)}f.forEach((function(e,o){Array.prototype.slice.call(e.childNodes).some((function(e){return e.value===n[o]}))&&(e.value=n[o])}))}function v(){var e,n,o=l.value;console.log("my audio destination:",o),n=o,void 0!==(e=a).sinkId?e.setSinkId(n).then((function(){console.log("Success, audio output device attached: ".concat(n))})).catch((function(e){"SecurityError"===e.name&&"You need to use HTTPS for selecting audio output device: ".concat(e),console.log(e.message+" : "+e.name),l.selectedIndex=0})):console.warn("Browser does not support output device selection.")}function g(e){return k(a,o=e),function(e){var n=document.createElement("video");n.setAttribute("id","callerVideo"),n.muted=!1,i.on("connection",(function(e){e.on("data",(function(e){if(1!=e)return E(),!1;(n=document.createElement("video")).setAttribute("id","sharedVideo"),console.log(e)}))})),i.on("close",(function(e){console.log("close")})),i.on("call",(function(o){null==e?o.answer():o.answer(e),o.on("stream",(function(e){k(n,e)})),o.on("finish",(function(){console.log("called finish")})),o.on("error",(function(e){alert(e)})),o.on("close",(function(){console.log(n),n.remove()})),p[o.peer]=o}))}(o),Object.keys(p).forEach((function(e){t!==e&&(i.call(e,o),call&&(call.on("error",(function(e){console.log(e)})),call.on("stream",(function(e){})),call.on("close",(function(){vid.remove(),console.log("user disconected")}))))})),navigator.mediaDevices.enumerateDevices()}l.disabled=!("sinkId"in HTMLMediaElement.prototype),navigator.mediaDevices.enumerateDevices().then(m).catch(h);var p={};function h(e){"NotFoundError"==e.name?(console.log("creating audi only"),navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then((function(e){o=e;var n=document.createElement("video");n.setAttribute("id","callerVideo"),n.muted=!1,k(a,o),b(o)})).catch((function(e){alert("Can't create audio")}))):console.log("navigator.MediaDevices.getUserMedia error: ",e.message,e.name)}function y(){window.stream&&window.stream.getTracks().forEach((function(e){e.stop()}));var e=u.value,n=s.value,o={audio:{deviceId:e?{exact:e}:void 0},video:{deviceId:n?{exact:n}:void 0}};navigator.mediaDevices.getUserMedia(o).then(g).then(m).catch((function(e){h(e)}))}function b(e){console.log("connect client Audio stream");var n=document.createElement("audio");n.setAttribute("id","callerAudio"),n.setAttribute("controls","controls"),n.muted=!1,i.on("connection",(function(e){e.on("data",(function(e){if(1!=e)return E(),!1;vid=document.createElement("video"),vid.setAttribute("id","sharedVideo"),console.log(e)}))})),i.on("close",(function(e){console.log("close")})),i.on("call",(function(o){null==e?o.answer():o.answer(e),o.on("stream",(function(e){!function(e,n){e.srcObject=n,e.addEventListener("loadedmetadata",(function(){e.play()})),r.append(e)}(n,e)})),o.on("finish",(function(){console.log("called finish")})),o.on("error",(function(e){alert(e)})),o.on("close",(function(){n.remove()})),p[o.peer]=o}))}function E(){document.getElementById("sharedVideo").remove()}function S(){navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then((function(e){sharedScreen=e,sharedScreen.getVideoTracks()[0].onended=function(){document.getElementById("sharedVideo").remove(),Object.keys(p).forEach((function(e){var n=i.connect(e);n.on("open",(function(){n.send(!1)}))}))},Object.keys(p).forEach((function(e){var n=i.connect(e);n.on("open",(function(){n.send(!0);var o=document.createElement("video");o.setAttribute("id","vid");var t=i.call(e,sharedScreen);t.on("error",(function(e){console.log(e)})),t.on("stream",(function(e){})),t.on("close",(function(){o.remove(),console.log("user disconect")}))}))})),function(e,n){e.srcObject=n,e.addEventListener("loadedmetadata",(function(){e.play()})),r.append(e)}(d,sharedScreen)}))}function k(e,n){e.srcObject=n,e.addEventListener("loadedmetadata",(function(){e.play()})),r.append(e)}c.on("connect",(function(){u.onchange=y,l.onchange=v,s.onchange=y,y()})),c.on("userJoined",(function(e){var n=e.id;e.roomID,e.user;console.log("new user joined",e);var t=i.call(n,o),c=document.createElement("video");c.setAttribute("id","userVid"),c.muted=!1,t&&(t.on("error",(function(e){console.log(e)})),t.on("stream",(function(e){k(c,e)})),t.on("close",(function(){c.remove(),console.log("user disconected")})),p[n]=t)})),i.on("open",(function(e){console.log("my peer id"+e),console.log("my user ",user),console.log("my room id ",roomID),t=e,data={id:e,user:user,roomID:roomID},c.emit("newUser",data)})),i.on("error",(function(e){console.log(e+" : "+e.type)})),c.on("userShared",(function(e,n){})),c.on("userDisconnect",(function(e){p[e]&&p[e].close()})),document.getElementById("stopCamera").addEventListener("click",(function(){o.getVideoTracks().forEach((function(e){"live"==e.readyState?e.stop():console.log("video broadcasting live")})),o.getTracks().forEach((function(e){"live"==e.readyState?e.stop():console.log("audio not broadcasting live")}))})),document.getElementById("toggleCamera").addEventListener("click",(function(){o.getVideoTracks().forEach((function(e){e.enabled=!e.enabled,console.log(e)}))})),document.getElementById("toggleAudio").addEventListener("click",(function(){o.getAudioTracks().forEach((function(e){return e.enabled=!e.enabled}))})),document.getElementById("shareScreen").addEventListener("click",(function(){S()}))}});
//# sourceMappingURL=webRTC.js.map