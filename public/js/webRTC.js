!function(e){var t={};function o(n){if(t[n])return t[n].exports;var c=t[n]={i:n,l:!1,exports:{}};return e[n].call(c.exports,c,c.exports,o),c.l=!0,c.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var c in e)o.d(n,c,function(t){return e[t]}.bind(null,c));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o(o.s=7)}({7:function(e,t,o){e.exports=o("ww2S")},ww2S:function(e,t){var o,n,c=io("https://rtcserver.esuccess-inc.com:40002",{}),a=new Peer({initiator:!1,trickle:!1}),l={},i=document.getElementById("myMediaContainer"),r=document.getElementById("videoGrid"),d=document.querySelector("select#audioSource"),u=document.querySelector("select#audioOutput"),s=document.querySelector("select#videoSource"),m=[d,u,s];function v(e){var t=m.map((function(e){return e.value}));m.forEach((function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}));for(var o=0;o!==e.length;++o){var n=e[o],c=document.createElement("option");c.value=n.deviceId,"audioinput"===n.kind?(c.text=n.label||"microphone ".concat(d.length+1),d.appendChild(c)):"audiooutput"===n.kind?(c.text=n.label||"speaker ".concat(u.length+1),u.appendChild(c)):"videoinput"===n.kind?(c.text=n.label||"camera ".concat(s.length+1),s.appendChild(c)):console.log("Some other kind of source/device: ",n)}m.forEach((function(e,o){Array.prototype.slice.call(e.childNodes).some((function(e){return e.value===t[o]}))&&(e.value=t[o])}))}function f(e){console.log("navigator.MediaDevices.getUserMedia error: ",e.message,e.name),data={id:myId,user:user,roomID:roomID},c.emit("newUser",data);console.log(data),y(!1,!0,data)}function g(e,t){e.srcObject=t,e.addEventListener("loadedmetadata",(function(){e.play()})),r.append(e)}function p(e,t){e.srcObject=t,e.addEventListener("loadedmetadata",(function(){e.play()})),r.append(e)}function E(e){var t=document.getElementById(e);t&&t.remove()}function h(e,t,a){navigator.mediaDevices.getUserMedia(a).then((function(a){return E("myVideo"),E("myAudio"),1==t&&1==e?(o=a,window.stream=a,n=null,console.log("this is a video"),videoElement=document.createElement("video"),videoElement.setAttribute("id","myVideo"),videoElement.muted=!0,function(e,t){e.srcObject=t,e.addEventListener("loadedmetadata",(function(){e.play()})),i.append(e)}(videoElement,a)):(o=null,window.stream=a,n=a,console.log("this is a audio only"),(t=document.createElement("audio")).setAttribute("class","myAudio"),t.setAttribute("controls","controls"),t.muted=!0,function(e,t){e.srcObject=t,e.addEventListener("loadedmetadata",(function(){e.play()})),i.append(e)}(t,a)),c.emit("changeMedia",data),navigator.mediaDevices.enumerateDevices()})).then(v).catch((function(o){1==e&&1==t?f(o):alert("no media detected, please connect and try again")}))}function y(e,t,o){window.stream&&window.stream.getTracks().forEach((function(e){e.stop()}));var n=d.value,c=s.value;if(1==e&&1==t)h(e,t,{audio:{deviceId:n?{exact:n}:void 0},video:{deviceId:c?{exact:c}:void 0}});else if(0==e&&1==t){h(e,t,{audio:{deviceId:n?{exact:n}:void 0},video:!1})}else alert("no media detected, please connect and try again")}function b(){window.stream&&window.stream.getTracks().forEach((function(e){e.stop()}));var e=d.value,t=s.value,n={audio:{deviceId:e?{exact:e}:void 0},video:{deviceId:t?{exact:t}:void 0}};navigator.mediaDevices.getUserMedia(n).then((function(e){console.log("restart"),window.stream=e,videoElement.srcObject=e,o=e,data={id:myId,user:user,roomID:roomID,videoStream:o},c.emit("changeMedia",data)})).catch(f)}u.disabled=!("sinkId"in HTMLMediaElement.prototype),navigator.mediaDevices.enumerateDevices().then(v).catch(f),d.onchange=b,u.onchange=function(){var e,t,o=u.value;e=videoElement,t=o,void 0!==e.sinkId?e.setSinkId(t).then((function(){console.log("Success, audio output device attached: ".concat(t))})).catch((function(e){var t=e;"SecurityError"===e.name&&(t="You need to use HTTPS for selecting audio output device: ".concat(e)),console.error(t),u.selectedIndex=0})):console.warn("Browser does not support output device selection.")},s.onchange=b,a.on("connection",(function(e){e.on("data",(function(e){console.log("peer connected",e)})),e.on("close",(function(){alert("close")}))})),a.on("open",(function(e){console.log("my peer id"+e),console.log("my user ",user),console.log("my room id ",roomID),myId=e,data={id:e,user:user,roomID:roomID},c.emit("newUser",data);y(!0,!0,data)})),a.on("call",(function(e){console.log("call"),e.answer(o),e.on("stream",(function(e){1==e.getAudioTracks().length&&1==e.getVideoTracks().length?(console.log("callback is a video"),E(data.id),callerElement=document.createElement("video"),callerElement.setAttribute("id",data.id),callerElement.setAttribute("class","callerBackVideo"),callerElement.muted=!1,p(callerElement,e)):(console.log("callback AUDIO"),E(data.id),callerElement=document.createElement("audio"),callerElement.setAttribute("id",data.id),callerElement.setAttribute("class","callbackAudio"),callerElement.setAttribute("controls","controls"),callerElement.muted=!1,g(callerElement,e))})),e.on("close",(function(){E(e.peer),console.log("user disconected")}))})),a.on("close",(function(e){document.getElementById(e).remove()})),c.on("userJoined",(function(e){})),c.on("mediaChanged",(function(e){var t=e.id,c=(e.roomID,e.user,null);if(null!==o?c=a.call(t,o):null!==n&&(c=a.call(t,n)),console.log("my video",o),console.log("my video",n),c){var i=0;c.on("stream",(function(t){0==i&&(console.log(t.getAudioTracks().length),console.log(t.getVideoTracks().length),1==t.getAudioTracks().length&&1==t.getVideoTracks().length?(console.log("user sent a video"),E(e.id),callerElement=document.createElement("video"),callerElement.setAttribute("id",e.id),callerElement.setAttribute("class","callerBackVideo"),callerElement.muted=!1,p(callerElement,t)):(console.log("user sent a AUDIO"),E(e.id),callerElement=document.createElement("audio"),callerElement.setAttribute("id",e.id),callerElement.setAttribute("class","callbackAudio"),callerElement.setAttribute("controls","controls"),callerElement.muted=!1,g(callerElement,t))),i++})),c.on("close",(function(){E(e.id)})),c.on("error",(function(e){console.log(e)})),l[e.id]=c}})),c.on("userDisconnect",(function(e){console.log("userDisconnected",e),E(e),l[e]&&l[e].close()}))}});
//# sourceMappingURL=webRTC.js.map