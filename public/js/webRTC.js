!function(e){var t={};function o(n){if(t[n])return t[n].exports;var l=t[n]={i:n,l:!1,exports:{}};return e[n].call(l.exports,l,l.exports,o),l.l=!0,l.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)o.d(n,l,function(t){return e[t]}.bind(null,l));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o(o.s=7)}({7:function(e,t,o){e.exports=o("ww2S")},ww2S:function(e,t){var o,n,l=io("https://rtcserver.esuccess-inc.com:40002",{}),a=null,c=new Peer({initiator:!1,trickle:!1}),i=null,r=null,d=null,u=!1,s={},m=document.getElementById("myMediaContainer"),v=document.getElementById("videoGrid"),g=document.querySelector("select#audioSource"),f=document.querySelector("select#audioOutput"),h=document.querySelector("select#videoSource"),E=[g,f,h];function b(e){var t=E.map((function(e){return e.value}));E.forEach((function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}));for(var o=0;o!==e.length;++o){var n=e[o],l=document.createElement("option");l.value=n.deviceId,"audioinput"===n.kind?(l.text=n.label||"microphone ".concat(g.length+1),g.appendChild(l)):"audiooutput"===n.kind?(l.text=n.label||"speaker ".concat(f.length+1),f.appendChild(l)):"videoinput"===n.kind?(l.text=n.label||"camera ".concat(h.length+1),h.appendChild(l)):console.log("Some other kind of source/device: ",n)}E.forEach((function(e,o){Array.prototype.slice.call(e.childNodes).some((function(e){return e.value===t[o]}))&&(e.value=t[o])}))}function p(e,t){e.muted=!0,void 0!==e.sinkId?e.setSinkId(t).then((function(){console.log("Success, audio output device attached: ".concat(t))})).catch((function(e){var t=e;"SecurityError"===e.name&&(t="You need to use HTTPS for selecting audio output device: ".concat(e)),console.error(t),f.selectedIndex=0})):console.warn("Browser does not support output device selection.")}function k(e){data={id:a,user:user,roomID:roomID},C(!1,!0,data)}function A(e,t){e.srcObject=t,e.addEventListener("loadedmetadata",(function(){e.play()})),v.append(e)}function y(e,t){e.srcObject=t,e.addEventListener("loadedmetadata",(function(){e.play()})),v.append(e)}function I(e,t,o){t.srcObject=o,t.addEventListener("loadedmetadata",(function(){t.play()}));var n=document.getElementById(e);n&&n.append(t)}function S(e){var t=document.getElementById(e);t&&(t.style.display="none")}function w(e){var t=document.getElementById(e);t&&t.remove()}function T(e,t,l){navigator.mediaDevices.getUserMedia(l).then((function(l){return w("myVideo"),w("myAudio"),1==t&&1==e?(null,i=l,window.stream=l,(o=document.createElement("video")).setAttribute("id","myVideo"),o.muted=!1,function(e,t){e.srcObject=t,e.muted=!0,e.addEventListener("loadedmetadata",(function(){e.play()})),m.append(e)}(o,l)):(i=null,window.stream=l,l,console.log("this is a audio only"),(n=document.createElement("audio")).setAttribute("id","myAudio"),n.setAttribute("controls","controls"),n.muted=!0,function(e,t){e.srcObject=t,e.muted=!0,e.addEventListener("loadedmetadata",(function(){e.play()})),m.append(e)}(n,l)),navigator.mediaDevices.enumerateDevices()})).then(b).catch((function(o){1==e&&1==t&&k()}))}function C(e,t,o){window.stream&&window.stream.getTracks().forEach((function(e){e.stop()}));var n=g.value,l=h.value;if(1==e&&1==t){var a={audio:{deviceId:n?{exact:n}:void 0},video:{deviceId:l?{exact:l}:void 0}};console.log("connect video : start"),T(e,t,a)}else if(0==e&&1==t){var c={audio:{deviceId:n?{exact:n}:void 0},video:!1};console.log("connect audio : start"),T(e,t,c)}}function D(){window.stream&&window.stream.getTracks().forEach((function(e){e.stop()}));var e=g.value,t=h.value,n={audio:{deviceId:e?{exact:e}:void 0},video:{deviceId:t?{exact:t}:void 0}};navigator.mediaDevices.getUserMedia(n).then((function(e){console.log("restarted"),window.stream=e,o.srcObject=e,i=e,data={id:a,user:user,roomID:roomID,videoStream:i},l.emit("changeMedia",data),w(a)})).catch(k)}function V(){var e=document.getElementById("lessonSlide");e&&(e.style.display="block");var t=document.getElementById("sharedVideo");t&&t.remove()}function _(){navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then((function(e){u=e;var t=document.createElement("video");t.setAttribute("id","sharedVideo"),t.muted=!1,I("lessonSharedContainer",t,e),S("lessonSlide"),console.log(s),Object.keys(s).forEach((function(e){var t=c.connect(e);t.on("open",(function(){var o={id:e,sharedScreen:!0};t.send(o);c.call(e,u)}))})),u.getVideoTracks()[0].onended=function(){var e,t;e="lessonSlide",(t=document.getElementById(e))&&(t.style.display="block"),document.getElementById("sharedVideo").remove(),Object.keys(s).forEach((function(e){var t=c.connect(e);t.on("open",(function(){var o={id:e,sharedScreen:!1};t.send(o)}))}))}}))}f.disabled=!("sinkId"in HTMLMediaElement.prototype),navigator.mediaDevices.enumerateDevices().then(b).catch(k),g.onchange=D,f.onchange=function(){var e=f.value;p(i?o:n,e)},h.onchange=D,c.on("connection",(function(e){e.on("data",(function(e){if(console.log("peer connected",e),1==e.sharedScreen)u=!0;else{if(0==e.sharedScreen)return V(),u=!1,!1;alert("the stream data")}})),e.on("close",(function(e){console.log("connection of peer has been closed",e)}))})),c.on("open",(function(e){console.log("my peer id"+e),console.log("my user ",user),console.log("my room id ",roomID),a=e,data={id:e,user:user,roomID:roomID},l.emit("newUser",data);C(!0,!0,data)})),c.on("call",(function(e){var t=0;console.log("PEER:: CALLING... for a video stream or audio stream ...");var o=g.value,n=h.value,l={audio:{deviceId:o?{exact:o}:void 0},video:{deviceId:n?{exact:n}:void 0}};navigator.mediaDevices.getUserMedia(l).then((function(o){r=o,1==o.getAudioTracks().length&&o.getVideoTracks().length,e.answer(o),e.on("stream",(function(o){if(o,s[e.peer]=e,console.log("recieve video from initiator ",e),0==t){if(1==u)return sharedVid=document.createElement("video"),sharedVid.setAttribute("id","sharedVideo"),I("lessonSharedContainer",sharedVid,o),S("lessonSlide"),!1;1==o.getAudioTracks().length&&1==o.getVideoTracks().length?(w(e.peer),callerElement=document.createElement("video"),callerElement.setAttribute("id",e.peer),callerElement.setAttribute("class","peerCallBackVideo"),callerElement.muted=!1,y(callerElement,o)):(w(e.peer),callerElement=document.createElement("audio"),callerElement.setAttribute("id",e.peer),callerElement.setAttribute("class","peerCallBackAudio"),callerElement.setAttribute("controls","controls"),callerElement.muted=!1,A(callerElement,o))}t++})),e.on("close",(function(){w(e.peer),console.log("user disconected")}))})).catch((function(o){console.log("recieve audio from initiator",e);var n=g.value,l={audio:{deviceId:n?{exact:n}:void 0},video:!1};navigator.mediaDevices.getUserMedia(l).then((function(o){r=o,1==o.getAudioTracks().length&&o.getVideoTracks().length,e.answer(o),e.on("stream",(function(o){if(o,s[e.peer]=e,0==t){if(1==u)return sharedVid=document.createElement("video"),sharedVid.setAttribute("id","sharedVideo"),I("lessonSharedContainer",sharedVid,o),S("lessonSlide"),!1;1==o.getAudioTracks().length&&1==o.getVideoTracks().length?(w(e.peer),callerElement=document.createElement("video"),callerElement.setAttribute("id",e.peer),callerElement.setAttribute("class","peerCallBackVideo"),callerElement.muted=!1,y(callerElement,o)):(w(e.peer),callerElement=document.createElement("audio"),callerElement.setAttribute("id",e.peer),callerElement.setAttribute("class","peerCallBackAudio"),callerElement.setAttribute("controls","controls"),callerElement.muted=!1,A(callerElement,o))}t++})),e.on("close",(function(){w(e.peer),console.log("user disconected")}))})).catch((function(e){}))}))})),c.on("close",(function(e){document.getElementById(e).remove()})),l.on("userJoined",(function(e){s[e.id]=e,console.log("user joined ::: calling initiator with just audio and video",e.id);var t=g.value,o=h.value,n={audio:{deviceId:t?{exact:t}:void 0},video:{deviceId:o?{exact:o}:void 0}};navigator.mediaDevices.getUserMedia(n).then((function(t){if(console.log("user joined ::: calling initiator with just audio and video",e.id),d=t,callback=c.call(e.id,t),callback){s[callback.peer]=callback;var o=0;callback.on("stream",(function(t){0==o&&(1==t.getAudioTracks().length&&1==t.getVideoTracks().length?(w(e.id),callerElement=document.createElement("video"),callerElement.setAttribute("id",e.id),callerElement.setAttribute("class","user_joined_peer_call_back"),callerElement.muted=!1,y(callerElement,t)):(w(e.id),callerElement=document.createElement("audio"),callerElement.setAttribute("id",e.id),callerElement.setAttribute("class","user_joined_peer_call_back"),callerElement.setAttribute("controls","controls"),callerElement.muted=!1,A(callerElement,t))),o++})),callback.on("close",(function(){w(e.id)})),callback.on("error",(function(e){console.log(e)}))}})).catch((function(o){console.log("user joined:: I have only audio, send to the audio to my peer",e.id);var n={audio:{deviceId:t?{exact:t}:void 0},video:!1};navigator.mediaDevices.getUserMedia(n).then((function(t){if(d=t,i?callback=c.call(e.id,t):(e={id:a,user:user,roomID:roomID,videoStream:t},l.emit("changeMedia",e),callback=null),callback){s[callback.peer]=callback;var o=0;callback.on("stream",(function(t){0==o&&(1==t.getAudioTracks().length&&1==t.getVideoTracks().length?(callerElement=document.createElement("video"),callerElement.setAttribute("id",e.id),callerElement.setAttribute("class","user_joined_peer_call_back"),callerElement.muted=!1,y(callerElement,t)):(w(e.id),callerElement=document.createElement("audio"),callerElement.setAttribute("id",e.id),callerElement.setAttribute("class","user_joined_peer_call_back"),callerElement.setAttribute("controls","controls"),callerElement.muted=!1,A(callerElement,t))),o++})),callback.on("close",(function(){w(e.id)})),callback.on("error",(function(e){console.log(e)})),s[e.id]=callback}})).catch((function(e){console.log(e)}))}))})),l.on("mediaChanged",(function(e){var t=g.value,o=h.value,n={audio:{deviceId:t?{exact:t}:void 0},video:{deviceId:o?{exact:o}:void 0}};navigator.mediaDevices.getUserMedia(n).then((function(t){if(console.log("mediaChanged: initiator (recieved)"),callback=c.call(e.id,t),callback){var o=0;callback.on("stream",(function(t){0==o&&(console.log("repipient callback : video stream"),1==t.getAudioTracks().length&&1==t.getVideoTracks().length?(w(e.id),callerElement=document.createElement("video"),callerElement.setAttribute("id",callback.peer),callerElement.setAttribute("class","repipient_video_changed"),callerElement.muted=!1,y(callerElement,t)):(w(e.id),callerElement=document.createElement("audio"),callerElement.setAttribute("id",e.id),callerElement.setAttribute("class","repipient_audio_changed"),callerElement.setAttribute("controls","controls"),callerElement.muted=!1,A(callerElement,t))),o++})),callback.on("close",(function(){w(e.id)})),callback.on("error",(function(e){console.log(e)})),s[e.id]=callback}})).catch((function(o){var n={audio:{deviceId:t?{exact:t}:void 0},video:!1};navigator.mediaDevices.getUserMedia(n).then((function(t){if(r=t,console.log("initiator SENT AND AUDIO"),callback=c.call(e.id,t),callback){var o=0;callback.on("stream",(function(e){e,console.log("this is for the audio, stream of the initiator"),0==o&&(console.log(e.getAudioTracks().length),console.log(e.getVideoTracks().length),1==e.getAudioTracks().length&&1==e.getVideoTracks().length?(console.log("user sent a video"),w(callback.peer),callerElement=document.createElement("video"),callerElement.setAttribute("id",callback.peer),callerElement.setAttribute("class","callerBackVideo"),callerElement.muted=!1,y(callerElement,e)):(console.log("user sent a AUDIO"),w(callback.peer),callerElement=document.createElement("audio"),callerElement.setAttribute("id",callback.peer),callerElement.setAttribute("class","callbackAudio_media"),callerElement.setAttribute("controls","controls"),callerElement.muted=!1,A(callerElement,e))),o++})),callback.on("close",(function(){w(e.id)})),callback.on("error",(function(e){console.log(e)})),s[e.id]=callback}})).catch((function(e){console.log(e)}))}))})),l.on("userDisconnect",(function(e){console.log("userDisconnected",e),w(e);try{s[e].close()}catch(e){console.log("error disconnect : ",e)}})),document.getElementById("btnShareScreen")&&document.getElementById("btnShareScreen").addEventListener("click",(function(){_()})),document.getElementById("toggleCamera")&&document.getElementById("toggleCamera").addEventListener("click",(function(){null!=d&&d.getVideoTracks().forEach((function(e){e.enabled=!e.enabled,console.log(e),1==e.enabled?($("#toggleCamera .fa-video").show(),$("#toggleCamera .fa-video-slash").hide()):($("#toggleCamera .fa-video").hide(),$("#toggleCamera .fa-video-slash").show())})),null!=r&&r.getVideoTracks().forEach((function(e){e.enabled=!e.enabled,console.log(e),1==e.enabled?($("#toggleCamera .fa-video").show(),$("#toggleCamera .fa-video-slash").hide()):($("#toggleCamera .fa-video").hide(),$("#toggleCamera .fa-video-slash").show())}))})),document.getElementById("toggleAudio")&&document.getElementById("toggleAudio").addEventListener("click",(function(){null!=d&&d.getAudioTracks().forEach((function(e){e.enabled=!e.enabled,console.log(e),1==e.enabled?($("#toggleAudio .fa-volume-up").show(),$("#toggleAudio .fa-volume-mute").hide()):($("#toggleAudio .fa-volume-up").hide(),$("#toggleAudio .fa-volume-mute").show())})),null!=r&&r.getAudioTracks().forEach((function(e){e.enabled=!e.enabled,console.log(e),1==e.enabled?($("#toggleAudio .fa-volume-up").show(),$("#toggleAudio .fa-volume-mute").hide()):($("#toggleAudio .fa-volume-up").hide(),$("#toggleAudio .fa-volume-mute").show())}))}));var j=document.getElementById("volume-control");j.addEventListener("input",(function(){var e;e=j.value,i.getAudioTracks().forEach((function(t){t.applyConstraints({volume:e})}))}))}});
//# sourceMappingURL=webRTC.js.map