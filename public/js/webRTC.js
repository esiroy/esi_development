!function(e){var o={};function n(t){if(o[t])return o[t].exports;var c=o[t]={i:t,l:!1,exports:{}};return e[t].call(c.exports,c,c.exports,n),c.l=!0,c.exports}n.m=e,n.c=o,n.d=function(e,o,t){n.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:t})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,o){if(1&o&&(e=n(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var c in e)n.d(t,c,function(o){return e[o]}.bind(null,c));return t},n.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(o,"a",o),o},n.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},n.p="/",n(n.s=7)}({7:function(e,o,n){e.exports=n("ww2S")},ww2S:function(e,o){var n,t,c,i,r=io("https://rtcserver.esuccess-inc.com:40002",{}),a=new Peer,d=document.getElementById("videoGrid"),u=document.createElement("video");u.setAttribute("id","myVideo"),u.muted=!0,console.log("user",user);var l=document.createElement("video");l.setAttribute("id","sharedVideo"),l.muted=!0;var s=document.querySelector("select#audioSource"),f=document.querySelector("select#audioOutput"),m=document.querySelector("select#videoSource"),v=[s,f,m];function g(e){var o=v.map((function(e){return e.value}));v.forEach((function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}));for(var n=0;n!==e.length;++n){var t=e[n],c=document.createElement("option");c.value=t.deviceId,"audioinput"===t.kind?(c.text=t.label||"microphone ".concat(s.length+1),s.appendChild(c)):"audiooutput"===t.kind?(c.text=t.label||"speaker ".concat(f.length+1),f.appendChild(c)):"videoinput"===t.kind?(c.text=t.label||"camera ".concat(m.length+1),m.appendChild(c)):console.log("Some other kind of source/device: ",t)}v.forEach((function(e,n){Array.prototype.slice.call(e.childNodes).some((function(e){return e.value===o[n]}))&&(e.value=o[n])}))}function h(){var e,o,n=f.value;console.log("my audio destination:",n),o=n,void 0!==(e=u).sinkId?e.setSinkId(o).then((function(){console.log("Success, audio output device attached: ".concat(o))})).catch((function(e){"SecurityError"===e.name&&"You need to use HTTPS for selecting audio output device: ".concat(e),console.log(e.message+" : "+e.name),f.selectedIndex=0})):console.warn("Browser does not support output device selection.")}function p(e){return w(u,n=e),function(e){var o=document.createElement("video");o.setAttribute("id","callerVideo"),o.muted=!1,a.on("connection",(function(e){e.on("data",(function(e){if(1!=e)return k(),!1;(o=document.createElement("video")).setAttribute("id","sharedVideo"),console.log(e)}))})),a.on("close",(function(e){console.log("close")})),a.on("call",(function(n){null==e?n.answer():n.answer(e),n.on("stream",(function(e){w(o,e)})),n.on("finish",(function(){console.log("called finish")})),n.on("error",(function(e){alert(e)})),n.on("close",(function(){console.log(o),o.remove()})),b[n.peer]=n}))}(n),Object.keys(b).forEach((function(e){i!==e&&(a.call(e,n),call&&(call.on("error",(function(e){console.log(e)})),call.on("stream",(function(e){})),call.on("close",(function(){vid.remove(),console.log("user disconected")}))))})),navigator.mediaDevices.enumerateDevices()}f.disabled=!("sinkId"in HTMLMediaElement.prototype),navigator.mediaDevices.enumerateDevices().then(g).catch(y);var b={};function y(e){console.log("navigator.MediaDevices.getUserMedia error: ",e.message,e.name),console.log("creating audi only"),navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then((function(e){t=e;var o=document.createElement("audio");o.setAttribute("id","myAudio"),o.setAttribute("controls","controls"),o.muted=!0,S(o,t),function(e){console.log("connect client Audio stream");var o=document.createElement("audio");o.setAttribute("id","callerAudio"),o.setAttribute("controls","controls"),o.muted=!1,a.on("connection",(function(e){e.on("data",(function(e){if(1!=e)return k(),!1;vid=document.createElement("video"),vid.setAttribute("id","sharedVideo"),console.log(e)}))})),a.on("close",(function(e){console.log("close")})),a.on("call",(function(n){null==e?n.answer():n.answer(e),n.on("stream",(function(e){S(o,e)})),n.on("finish",(function(){console.log("called finish")})),n.on("error",(function(e){alert(e)})),n.on("close",(function(){o.remove()})),b[n.peer]=n}))}(t)})).catch((function(e){alert("Can't create audio")}))}function E(){window.stream&&window.stream.getTracks().forEach((function(e){e.stop()}));var e=s.value,o=m.value,n={audio:{deviceId:e?{exact:e}:void 0},video:{deviceId:o?{exact:o}:void 0}};navigator.mediaDevices.getUserMedia(n).then(p).then(g).catch((function(e){y(e)}))}function k(){document.getElementById("sharedVideo").remove()}function A(){navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then((function(e){sharedScreen=e,sharedScreen.getVideoTracks()[0].onended=function(){document.getElementById("sharedVideo").remove(),Object.keys(b).forEach((function(e){var o=a.connect(e);o.on("open",(function(){o.send(!1)}))}))},Object.keys(b).forEach((function(e){var o=a.connect(e);o.on("open",(function(){o.send(!0);var n=document.createElement("video");n.setAttribute("id","vid");var t=a.call(e,sharedScreen);t.on("error",(function(e){console.log(e)})),t.on("stream",(function(e){})),t.on("close",(function(){n.remove(),console.log("user disconect")}))}))})),function(e,o){e.srcObject=o,e.addEventListener("loadedmetadata",(function(){e.play()})),d.append(e)}(l,sharedScreen)}))}function S(e,o){e.srcObject=o,e.addEventListener("loadedmetadata",(function(){e.play()})),d.append(e)}function w(e,o){e.srcObject=o,e.addEventListener("loadedmetadata",(function(){e.play()})),d.append(e)}r.on("connect",(function(){s.onchange=E,f.onchange=h,m.onchange=E,E()})),r.on("userJoined",(function(e){var o=e.id;e.roomID,e.user;if(console.log("new user joined",e),n){var i=a.call(o,n);i&&(i.on("error",(function(e){console.log(e)})),i.on("stream",(function(e){if(console.log("on stream while I have a video"),e.getAudioTracks().length&&e.getVideoTracks().length){var o=document.createElement("video");o.setAttribute("id","userVideo"),o.muted=!1,w(o,e)}else{var n=document.createElement("audio");n.setAttribute("id","callerAudio"),n.setAttribute("controls","controls"),n.muted=!1,S(n,e)}})),i.on("close",(function(){c.getAudioTracks().length&&c.getVideoTracks().length?vid.remove():audioElement.remove(),console.log("user disconected")})),b[o]=i)}else{var r=a.call(o,t);r&&(r.on("error",(function(e){console.log(e)})),r.on("stream",(function(e){if(console.log("on stream while i'm on audio"),c=e,e.getAudioTracks().length&&e.getVideoTracks().length){var o=document.createElement("video");o.setAttribute("id","userVideo"),o.muted=!1,w(o,e)}else{var n=document.createElement("audio");n.setAttribute("id","callerAudio"),n.setAttribute("controls","controls"),n.muted=!1,S(n,e)}})),r.on("close",(function(){c.getAudioTracks().length&&c.getVideoTracks().length?vid.remove():audioElement.remove(),console.log("user disconected")})),b[o]=r)}})),a.on("open",(function(e){console.log("my peer id"+e),console.log("my user ",user),console.log("my room id ",roomID),i=e,data={id:e,user:user,roomID:roomID},r.emit("newUser",data)})),a.on("error",(function(e){console.log(e+" : "+e.type)})),r.on("userShared",(function(e,o){})),r.on("userDisconnect",(function(e){b[e]&&b[e].close()})),document.getElementById("stopCamera").addEventListener("click",(function(){n.getVideoTracks().forEach((function(e){"live"==e.readyState?e.stop():console.log("video broadcasting live")})),n.getTracks().forEach((function(e){"live"==e.readyState?e.stop():console.log("audio not broadcasting live")}))})),document.getElementById("toggleCamera").addEventListener("click",(function(){n.getVideoTracks().forEach((function(e){e.enabled=!e.enabled,console.log(e)}))})),document.getElementById("toggleAudio").addEventListener("click",(function(){n.getAudioTracks().forEach((function(e){return e.enabled=!e.enabled}))})),document.getElementById("shareScreen").addEventListener("click",(function(){A()}))}});
//# sourceMappingURL=webRTC.js.map