!function(e){var o={};function n(t){if(o[t])return o[t].exports;var c=o[t]={i:t,l:!1,exports:{}};return e[t].call(c.exports,c,c.exports,n),c.l=!0,c.exports}n.m=e,n.c=o,n.d=function(e,o,t){n.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:t})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,o){if(1&o&&(e=n(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var c in e)n.d(t,c,function(o){return e[o]}.bind(null,c));return t},n.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(o,"a",o),o},n.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},n.p="/",n(n.s=7)}({7:function(e,o,n){e.exports=n("ww2S")},ww2S:function(e,o){var n,t,c,r=io("https://rtcserver.esuccess-inc.com:40002",{}),i=new Peer,a=document.getElementById("videoGrid"),d=document.createElement("video");d.setAttribute("id","myVideo"),d.muted=!0,console.log("user",user);var u=document.createElement("video");u.setAttribute("id","sharedVideo"),u.muted=!0;var l=document.querySelector("select#audioSource"),s=document.querySelector("select#audioOutput"),f=document.querySelector("select#videoSource"),m=[l,s,f];function v(e){var o=m.map((function(e){return e.value}));m.forEach((function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}));for(var n=0;n!==e.length;++n){var t=e[n],c=document.createElement("option");c.value=t.deviceId,"audioinput"===t.kind?(c.text=t.label||"microphone ".concat(l.length+1),l.appendChild(c)):"audiooutput"===t.kind?(c.text=t.label||"speaker ".concat(s.length+1),s.appendChild(c)):"videoinput"===t.kind?(c.text=t.label||"camera ".concat(f.length+1),f.appendChild(c)):console.log("Some other kind of source/device: ",t)}m.forEach((function(e,n){Array.prototype.slice.call(e.childNodes).some((function(e){return e.value===o[n]}))&&(e.value=o[n])}))}function g(){var e,o,n=s.value;console.log("my audio destination:",n),o=n,void 0!==(e=d).sinkId?e.setSinkId(o).then((function(){console.log("Success, audio output device attached: ".concat(o))})).catch((function(e){"SecurityError"===e.name&&"You need to use HTTPS for selecting audio output device: ".concat(e),console.log(e.message+" : "+e.name),s.selectedIndex=0})):console.warn("Browser does not support output device selection.")}function p(e){return w(d,n=e),E(n),Object.keys(h).forEach((function(e){c!==e&&(i.call(e,n),call&&(call.on("error",(function(e){console.log(e)})),call.on("stream",(function(e){})),call.on("close",(function(){vid.remove(),console.log("user disconected")}))))})),navigator.mediaDevices.enumerateDevices()}s.disabled=!("sinkId"in HTMLMediaElement.prototype),navigator.mediaDevices.enumerateDevices().then(v).catch(y);var h={};function y(e){"NotFoundError"==e.name?(console.log("creating audi only"),navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then((function(e){t=e;var o=document.createElement("audio");o.setAttribute("id","myAudio"),o.setAttribute("controls","controls"),o.muted=!0,I(o,t),E(t)})).catch((function(e){alert("Can't create audio")}))):console.log("navigator.MediaDevices.getUserMedia error: ",e.message,e.name)}function b(){window.stream&&window.stream.getTracks().forEach((function(e){e.stop()}));var e=l.value,o=f.value,n={audio:{deviceId:e?{exact:e}:void 0},video:{deviceId:o?{exact:o}:void 0}};navigator.mediaDevices.getUserMedia(n).then(p).then(v).catch((function(e){y(e)}))}function E(e){var o=document.createElement("video");o.setAttribute("id","callerVideo"),o.muted=!1,i.on("connection",(function(e){e.on("data",(function(e){if(1!=e)return S(),!1;(o=document.createElement("video")).setAttribute("id","sharedVideo"),console.log(e)}))})),i.on("close",(function(e){console.log("close")})),i.on("call",(function(n){null==e?n.answer():n.answer(e),n.on("stream",(function(e){w(o,e)})),n.on("finish",(function(){console.log("called finish")})),n.on("error",(function(e){alert(e)})),n.on("close",(function(){console.log(o),o.remove()})),h[n.peer]=n}))}function S(){document.getElementById("sharedVideo").remove()}function k(){navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then((function(e){sharedScreen=e,sharedScreen.getVideoTracks()[0].onended=function(){document.getElementById("sharedVideo").remove(),Object.keys(h).forEach((function(e){var o=i.connect(e);o.on("open",(function(){o.send(!1)}))}))},Object.keys(h).forEach((function(e){var o=i.connect(e);o.on("open",(function(){o.send(!0);var n=document.createElement("video");n.setAttribute("id","vid");var t=i.call(e,sharedScreen);t.on("error",(function(e){console.log(e)})),t.on("stream",(function(e){})),t.on("close",(function(){n.remove(),console.log("user disconect")}))}))})),function(e,o){e.srcObject=o,e.addEventListener("loadedmetadata",(function(){e.play()})),a.append(e)}(u,sharedScreen)}))}function I(e,o){e.srcObject=o,e.addEventListener("loadedmetadata",(function(){e.play()})),a.append(e)}function w(e,o){e.srcObject=o,e.addEventListener("loadedmetadata",(function(){e.play()})),a.append(e)}r.on("connect",(function(){l.onchange=b,s.onchange=g,f.onchange=b,b()})),r.on("userJoined",(function(e){var o=e.id;e.roomID,e.user;console.log("new user joined",e);var t=i.call(o,n),c=document.createElement("video");c.setAttribute("id","userVid"),c.muted=!0,t&&(t.on("error",(function(e){console.log(e)})),t.on("stream",(function(e){w(c,e)})),t.on("close",(function(){c.remove(),console.log("user disconected")})),h[o]=t)})),i.on("open",(function(e){console.log("my peer id"+e),console.log("my user ",user),console.log("my room id ",roomID),c=e,data={id:e,user:user,roomID:roomID},r.emit("newUser",data)})),i.on("error",(function(e){console.log(e+" : "+e.type)})),r.on("userShared",(function(e,o){})),r.on("userDisconnect",(function(e){h[e]&&h[e].close()})),document.getElementById("stopCamera").addEventListener("click",(function(){n.getVideoTracks().forEach((function(e){"live"==e.readyState?e.stop():console.log("video broadcasting live")})),n.getTracks().forEach((function(e){"live"==e.readyState?e.stop():console.log("audio not broadcasting live")}))})),document.getElementById("toggleCamera").addEventListener("click",(function(){n.getVideoTracks().forEach((function(e){e.enabled=!e.enabled,console.log(e)}))})),document.getElementById("toggleAudio").addEventListener("click",(function(){n.getAudioTracks().forEach((function(e){return e.enabled=!e.enabled}))})),document.getElementById("shareScreen").addEventListener("click",(function(){k()}))}});
//# sourceMappingURL=webRTC.js.map