!function(e){var n={};function o(t){if(n[t])return n[t].exports;var c=n[t]={i:t,l:!1,exports:{}};return e[t].call(c.exports,c,c.exports,o),c.l=!0,c.exports}o.m=e,o.c=n,o.d=function(e,n,t){o.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,n){if(1&n&&(e=o(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var c in e)o.d(t,c,function(n){return e[n]}.bind(null,c));return t},o.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(n,"a",n),n},o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},o.p="/",o(o.s=7)}({7:function(e,n,o){e.exports=o("ww2S")},ww2S:function(e,n){var o,t=io("https://rtcserver.esuccess-inc.com:40002",{}),c=new Peer,r=document.getElementById("videoGrid"),i=document.createElement("video");i.setAttribute("id","myVideo"),i.muted=!0;var a=document.createElement("video");a.setAttribute("id","sharedVideo");var d=document.querySelector("video");d.setAttribute("id","myVideo"),d.muted=!0;var u=document.querySelector("select#audioSource"),l=document.querySelector("select#audioOutput"),s=document.querySelector("select#videoSource"),f=[u,l,s];function v(e){var n=f.map((function(e){return e.value}));f.forEach((function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}));for(var o=0;o!==e.length;++o){var t=e[o],c=document.createElement("option");c.value=t.deviceId,"audioinput"===t.kind?(c.text=t.label||"microphone ".concat(u.length+1),u.appendChild(c)):"audiooutput"===t.kind?(c.text=t.label||"speaker ".concat(l.length+1),l.appendChild(c)):"videoinput"===t.kind?(c.text=t.label||"camera ".concat(s.length+1),s.appendChild(c)):console.log("Some other kind of source/device: ",t)}f.forEach((function(e,o){Array.prototype.slice.call(e.childNodes).some((function(e){return e.value===n[o]}))&&(e.value=n[o])}))}function m(){var e,n,o=l.value;n=o,void 0!==(e=d).sinkId?e.setSinkId(n).then((function(){console.log("Success, audio output device attached: ".concat(n))})).catch((function(e){var n=e;"SecurityError"===e.name&&(n="You need to use HTTPS for selecting audio output device: ".concat(e)),console.error(n),l.selectedIndex=0})):console.warn("Browser does not support output device selection.")}function g(e){return window.stream=e,d.srcObject=e,b(o=e),Object.keys(p).forEach((function(e){c.call(e,o),call&&(call.on("error",(function(e){console.log(e)})),call.on("stream",(function(e){})),call.on("close",(function(){vid.remove(),console.log("user disconected")})))})),navigator.mediaDevices.enumerateDevices()}l.disabled=!("sinkId"in HTMLMediaElement.prototype),navigator.mediaDevices.enumerateDevices().then(v).catch(h);var p={};function h(e){console.log("navigator.MediaDevices.getUserMedia error: ",e.message,e.name)}function y(){var e=u.value,n=s.value,o={audio:{deviceId:e?{exact:e}:void 0},video:{deviceId:n?{exact:n}:void 0}};navigator.mediaDevices.getUserMedia(o).then(g).then(v).catch(h)}function b(e){var n=document.createElement("video");n.setAttribute("id","callerVideo"),n.muted=!1,c.on("connection",(function(e){e.on("data",(function(e){if(1!=e)return document.getElementById("sharedVideo").remove(),!1;(n=document.createElement("video")).setAttribute("id","sharedVideo"),console.log(e)}))})),c.on("close",(function(e){console.log("close")})),c.on("call",(function(o){null==e?o.answer():o.answer(e),o.on("stream",(function(e){S(n,e)})),o.on("finish",(function(){console.log("called finish")})),o.on("error",(function(e){alert(e)})),o.on("close",(function(){console.log(n),n.remove()})),p[o.peer]=o}))}function E(){navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then((function(e){sharedScreen=e,sharedScreen.getVideoTracks()[0].onended=function(){document.getElementById("sharedVideo").remove(),Object.keys(p).forEach((function(e){var n=c.connect(e);n.on("open",(function(){n.send(!1)}))}))},Object.keys(p).forEach((function(e){var n=c.connect(e);n.on("open",(function(){n.send(!0);var o=document.createElement("video");o.setAttribute("id","vid");var t=c.call(e,sharedScreen);t.on("error",(function(e){console.log(e)})),t.on("stream",(function(e){})),t.on("close",(function(){o.remove(),console.log("user disconect")}))}))})),function(e,n){e.srcObject=n,e.addEventListener("loadedmetadata",(function(){e.play()})),r.append(e)}(a,sharedScreen)}))}function S(e,n){e.srcObject=n,e.addEventListener("loadedmetadata",(function(){e.play()})),r.append(e)}t.on("connect",(function(){u.onchange=y,l.onchange=m,s.onchange=y,y()})),t.on("userJoined",(function(e){console.log("new user joined",e);var n=c.call(e,o),t=document.createElement("video");t.setAttribute("id","userVid"),t.muted=!1,n&&(n.on("error",(function(e){console.log(e)})),n.on("stream",(function(e){S(t,e)})),n.on("close",(function(){t.remove(),console.log("user disconected")})),p[e]=n)})),c.on("open",(function(e){console.log("my peer id"+e),e,t.emit("newUser",e,roomID)})),c.on("error",(function(e){console.log(e+" : "+e.type)})),t.on("userShared",(function(e,n){})),t.on("userDisconnect",(function(e){p[e]&&p[e].close()})),document.getElementById("stopCamera").addEventListener("click",(function(){o.getVideoTracks().forEach((function(e){"live"==e.readyState?e.stop():console.log("video broadcasting live")})),o.getTracks().forEach((function(e){"live"==e.readyState?e.stop():console.log("audio not broadcasting live")}))})),document.getElementById("toggleCamera").addEventListener("click",(function(){o.getVideoTracks().forEach((function(e){e.enabled=!e.enabled,console.log(e)}))})),document.getElementById("toggleAudio").addEventListener("click",(function(){o.getAudioTracks().forEach((function(e){return e.enabled=!e.enabled}))})),document.getElementById("shareScreen").addEventListener("click",(function(){E()}))}});
//# sourceMappingURL=webRTC.js.map